<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Java," />










<meta name="description" content="StringString创建对象的两种方式 通过new创建的字符串对象，每一次new都会申请一个内存空间，不管内容是否相同，每次申请的内存空间地址值都是不同的 以””直接赋值的方式创建的字符串对象，是在常量池中维护的。在通过这种方式创建字符串对象时，JVM会在常量池中查找有没有已经存在的值和要创建的值相同的对象，如果有就把它赋给当前引用，如果没有就在常量池中重新创建一个 String 对象  如果">
<meta name="keywords" content="Java">
<meta property="og:type" content="article">
<meta property="og:title" content="String StringBuffer和StringBuilder">
<meta property="og:url" content="http://yoursite.com/2021/01/20/String-StringBuffer和StringBuilder/index.html">
<meta property="og:site_name" content="妖精仓库">
<meta property="og:description" content="StringString创建对象的两种方式 通过new创建的字符串对象，每一次new都会申请一个内存空间，不管内容是否相同，每次申请的内存空间地址值都是不同的 以””直接赋值的方式创建的字符串对象，是在常量池中维护的。在通过这种方式创建字符串对象时，JVM会在常量池中查找有没有已经存在的值和要创建的值相同的对象，如果有就把它赋给当前引用，如果没有就在常量池中重新创建一个 String 对象  如果">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/2021/01/20/String-StringBuffer和StringBuilder/String_Overview.png">
<meta property="og:image" content="http://yoursite.com/2021/01/20/String-StringBuffer和StringBuilder/StringBuilder_NotSafe.png">
<meta property="og:image" content="http://yoursite.com/2021/01/20/String-StringBuffer和StringBuilder/StringBuilder_Error.jpg">
<meta property="og:image" content="http://yoursite.com/2021/01/20/String-StringBuffer和StringBuilder/Compare_String_Buffer_Builder.png">
<meta property="og:updated_time" content="2021-01-20T10:59:01.456Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="String StringBuffer和StringBuilder">
<meta name="twitter:description" content="StringString创建对象的两种方式 通过new创建的字符串对象，每一次new都会申请一个内存空间，不管内容是否相同，每次申请的内存空间地址值都是不同的 以””直接赋值的方式创建的字符串对象，是在常量池中维护的。在通过这种方式创建字符串对象时，JVM会在常量池中查找有没有已经存在的值和要创建的值相同的对象，如果有就把它赋给当前引用，如果没有就在常量池中重新创建一个 String 对象  如果">
<meta name="twitter:image" content="http://yoursite.com/2021/01/20/String-StringBuffer和StringBuilder/String_Overview.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2021/01/20/String-StringBuffer和StringBuilder/"/>





  <title>String StringBuffer和StringBuilder | 妖精仓库</title>
  








  <!-- 把这段代码加入 themes/next/layout/_layout.swig 的 </body> 前 -->
  <script type="text/javascript" src="/js/src/love.js"></script>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"><a href="https://github.com/Shironota" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style></div>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">妖精仓库</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/01/20/String-StringBuffer和StringBuilder/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PiccoloDevil">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="妖精仓库">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">String StringBuffer和StringBuilder</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-01-20T16:24:03+08:00">
                2021-01-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                3.9k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  17 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="String"><a href="#String" class="headerlink" title="String"></a>String</h2><h3 id="String创建对象的两种方式"><a href="#String创建对象的两种方式" class="headerlink" title="String创建对象的两种方式"></a>String创建对象的两种方式</h3><ol>
<li>通过new创建的字符串对象，每一次new都会申请一个内存空间，不管内容是否相同，每次申请的内存空间地址值都是不同的</li>
<li>以””直接赋值的方式创建的字符串对象，是在常量池中维护的。在通过这种方式创建字符串对象时，JVM会在常量池中查找有没有已经存在的值和要创建的值相同的对象，如果有就把它赋给当前引用，如果没有就在常量池中重新创建一个 String 对象</li>
</ol>
<p>如果对字符串进行拼接操作，每次拼接都会创建一个新的String对象，然后将引用指向新的 String 对象，这种不可避免的操作既耗时又浪费内存空间，Java提供的StringBuilder类可以解决这个问题</p>
<h3 id="String是不可变的"><a href="#String是不可变的" class="headerlink" title="String是不可变的"></a>String是不可变的</h3><h4 id="String的不可变是什么意思？"><a href="#String的不可变是什么意思？" class="headerlink" title="String的不可变是什么意思？"></a><strong>String的不可变是什么意思？</strong></h4><p>  不可变是指，若存在一个字符串”hello”，第二次给它赋值成“helloworld”，此时是在内存中新建了一个对象，并将引用变量指向新对象地址，原对象中的内容仍然是”hello”，String一旦赋值即不可变</p>
<h4 id="为什么String是不可变的？"><a href="#为什么String是不可变的？" class="headerlink" title="为什么String是不可变的？"></a><strong>为什么String是不可变的？</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">String</span></span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">Comparable</span>&lt;<span class="title">String</span>&gt;, <span class="title">CharSequence</span> </span>&#123;</span><br><span class="line">    <span class="comment">/** The value is used for character storage. */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">char</span> value[];</span><br></pre></td></tr></table></figure>
<p>观察String的源码，String类是用final关键字修饰的，这说明String<strong>不可继承</strong>。然后<code>private final char value[]</code>可见<code>String</code> 类中使用 final 关键字修饰字符数组来保存字符串，这说明String是<strong>不可变的</strong></p>
<blockquote>
<p>在 Java 9 之后，String 类的实现改用 byte 数组存储字符串 <code>private final byte[] value</code>;</p>
</blockquote>
<h4 id="关于String不可变的小问题"><a href="#关于String不可变的小问题" class="headerlink" title="关于String不可变的小问题"></a>关于String不可变的小问题</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    String str = <span class="string">"Hello"</span>;</span><br><span class="line">    str = str + <span class="string">"World"</span>;</span><br><span class="line">    System.out.println(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码，执行结果是HelloWorld，发现String的值发生了改变。那么，问题出在哪？</p>
<p>利用反编译分析的结果，在使用<code>+</code>进行字符串的拼接的时候，实际上jvm是初始化了一个<code>StringBuilder</code>进行拼接的</p>
<p>相当于实际执行的代码段如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    String str = <span class="string">"Hello"</span>;</span><br><span class="line">    <span class="comment">//str = str + "World";</span></span><br><span class="line">    StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    stringBuilder.append(str).append(<span class="string">"World"</span>);</span><br><span class="line">    str = stringBuilder.toString();</span><br><span class="line">    System.out.println(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再延伸一个问题，观察下列代码段，判断程序输出结果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    String str = <span class="keyword">null</span>;</span><br><span class="line">    str = str + <span class="string">""</span>;</span><br><span class="line">    System.out.println(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>答案是输出<strong>null</strong>。因为<code>+</code>实际上是调用<code>StringBuilder</code>的<code>append()</code>方法</p>
<p>再分析一下<code>StringBuilder</code>中<code>append()</code>方法的源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> StringBuilder <span class="title">append</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.append(str);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再定位到父类的<code>append()</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> AbstractStringBuilder <span class="title">append</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (str == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> appendNull();</span><br><span class="line">    <span class="keyword">int</span> len = str.length();</span><br><span class="line">    ensureCapacityInternal(count + len);</span><br><span class="line">    str.getChars(<span class="number">0</span>, len, value, count);</span><br><span class="line">    count += len;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再查看<code>appendNull()</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> AbstractStringBuilder <span class="title">appendNull</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> c = count;</span><br><span class="line">    ensureCapacityInternal(c + <span class="number">4</span>);</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">char</span>[] value = <span class="keyword">this</span>.value;</span><br><span class="line">    value[c++] = <span class="string">'n'</span>;</span><br><span class="line">    value[c++] = <span class="string">'u'</span>;</span><br><span class="line">    value[c++] = <span class="string">'l'</span>;</span><br><span class="line">    value[c++] = <span class="string">'l'</span>;</span><br><span class="line">    count = c;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以，如果传入的字符串是<code>null</code>时，调用<code>appendNull()</code>方法，返回null</p>
<h2 id="StringBuffer"><a href="#StringBuffer" class="headerlink" title="StringBuffer"></a>StringBuffer</h2><h3 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//无参构造，创建一个空的StringBuffer对象</span></span><br><span class="line">    StringBuffer stringBuffer = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    System.out.println(<span class="string">"StringBuffer:"</span> + stringBuffer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取长度</span></span><br><span class="line">    System.out.println(<span class="string">"StringBuffer的长度:"</span> + stringBuffer.length());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//有参构造</span></span><br><span class="line">    stringBuffer = <span class="keyword">new</span> StringBuffer(<span class="string">"Hello World"</span>);</span><br><span class="line">    System.out.println(<span class="string">"StringBuffer:"</span> + stringBuffer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据索引取值</span></span><br><span class="line">    System.out.println(<span class="string">"下标为2的字符是："</span> + stringBuffer.charAt(<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加：append()</span></span><br><span class="line">    stringBuffer = stringBuffer.append(<span class="string">" Java"</span>);</span><br><span class="line">    System.out.println(<span class="string">"append之后的StringBuffer："</span> + stringBuffer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除指定区间内的字符：delete(int start, int end)</span></span><br><span class="line">    stringBuffer = stringBuffer.delete(<span class="number">6</span>, <span class="number">12</span>);</span><br><span class="line">    System.out.println(<span class="string">"delete之后的StringBuffer："</span> + stringBuffer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除指定索引位置处的字符：deleteCharAt(int index)</span></span><br><span class="line">    stringBuffer = stringBuffer.deleteCharAt(<span class="number">3</span>);</span><br><span class="line">    System.out.println(<span class="string">"deleteCharAt之后的StringBuffer："</span> + stringBuffer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将指定区间内的值替换：replace(int start, int end, String str)</span></span><br><span class="line">    stringBuffer = stringBuffer.replace(<span class="number">0</span>, <span class="number">4</span>, <span class="string">"StringBuffer"</span>);</span><br><span class="line">    System.out.println(<span class="string">"replace之后的StringBuffer："</span> + stringBuffer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//截取字符串（从指定位置到结尾）：substring(int start)</span></span><br><span class="line">    String str = stringBuffer.substring(<span class="number">6</span>);</span><br><span class="line">    System.out.println(<span class="string">"substring之后的String："</span> + str);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//截取字符串（从指定位置到指定位置）：substring(int start, int end)</span></span><br><span class="line">    str = stringBuffer.substring(<span class="number">0</span>, <span class="number">12</span>);</span><br><span class="line">    System.out.println(<span class="string">"substring之后的String："</span> + str);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//向指定位置插入：insert(int offset, String str)</span></span><br><span class="line">    stringBuffer = stringBuffer.insert(<span class="number">0</span>, <span class="string">"Hello "</span>);</span><br><span class="line">    System.out.println(<span class="string">"insert之后的StringBuffer："</span> + stringBuffer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从头开始查找指定字符的索引位置：indexOf(String str)</span></span><br><span class="line">    System.out.println(<span class="string">"Java的下标是："</span> + stringBuffer.indexOf(<span class="string">"Java"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从指定位置开始查找指定字符的索引位置：indexOf(String str, int fromIndex)</span></span><br><span class="line">    System.out.println(<span class="string">"下标21之后的a的下标是："</span> + stringBuffer.indexOf(<span class="string">"a"</span>, <span class="number">21</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//字符串反转：reverse()</span></span><br><span class="line">    stringBuffer = stringBuffer.reverse();</span><br><span class="line">    System.out.println(<span class="string">"reverse之后的StringBuffer："</span> + stringBuffer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回StringBuffer对应的String：toString()</span></span><br><span class="line">    str = stringBuffer.toString();</span><br><span class="line">    System.out.println(<span class="string">"StringBuffer对应的String："</span> + str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">StringBuffer</span></span></span><br><span class="line"><span class="class">   <span class="keyword">extends</span> <span class="title">AbstractStringBuilder</span></span></span><br><span class="line"><span class="class">   <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">CharSequence</span></span></span><br></pre></td></tr></table></figure>
<p><code>StringBuffer</code>类继承自<code>AbstractStringBuilder</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractStringBuilder</span> <span class="keyword">implements</span> <span class="title">Appendable</span>, <span class="title">CharSequence</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The value is used for character storage.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">char</span>[] value;</span><br></pre></td></tr></table></figure>
<p><code>AbstractStringBuilder</code>类底层实现中也是使用字符数组保存字符串，且该字符数组没有用<code>final</code>关键字修饰，所以内容是<strong>可变的</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs a string buffer with no characters in it and an</span></span><br><span class="line"><span class="comment"> * initial capacity of 16 characters.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">StringBuffer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(<span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>StringBuffer</code>底层用数组来存储字符串的值，并且数组的默认长度是16。实例化一个空的<code>StringBuffer</code>对象即创建了一个大小为16个字符的字符串缓冲区</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs a string buffer initialized to the contents of the</span></span><br><span class="line"><span class="comment"> * specified string. The initial capacity of the string buffer is</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> 16&#125; plus the length of the string argument.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>   str   the initial contents of the buffer.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">StringBuffer</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(str.length() + <span class="number">16</span>);</span><br><span class="line">    append(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当调用带参构造创建<code>StringBuffer</code>对象时，字符数组的长度为传入的参数的长度+16。根据源码，<code>super(str.length() + 16);</code>创建一个长度为str长度+16的字符串缓冲区，<code>append(str);</code>将str添加到字符串数组中。这意味着一个StringBuffer对象创建完成后，可以有16个字符的缓冲空间以供对其值进行修改。</p>
<p>那么如果修改的值范围超过了16呢？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">ensureCapacity</span><span class="params">(<span class="keyword">int</span> minimumCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.ensureCapacity(minimumCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ensureCapacity</span><span class="params">(<span class="keyword">int</span> minimumCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (minimumCapacity &gt; <span class="number">0</span>)</span><br><span class="line">        ensureCapacityInternal(minimumCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * For positive values of &#123;<span class="doctag">@code</span> minimumCapacity&#125;, this method</span></span><br><span class="line"><span class="comment"> * behaves like &#123;<span class="doctag">@code</span> ensureCapacity&#125;, however it is never</span></span><br><span class="line"><span class="comment"> * synchronized.</span></span><br><span class="line"><span class="comment"> * If &#123;<span class="doctag">@code</span> minimumCapacity&#125; is non positive due to numeric</span></span><br><span class="line"><span class="comment"> * overflow, this method throws &#123;<span class="doctag">@code</span> OutOfMemoryError&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureCapacityInternal</span><span class="params">(<span class="keyword">int</span> minimumCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// overflow-conscious code</span></span><br><span class="line">    <span class="keyword">if</span> (minimumCapacity - value.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        value = Arrays.copyOf(value,</span><br><span class="line">                newCapacity(minimumCapacity));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现，如果修改的值超过了缓冲区的容量，会调用<code>ensureCapacityInternal()</code>方法来检查<code>StringBuffer</code>对象的原char数组长度能否满足要求，如果不能，则对数组进行扩容。扩容完成后调用<code>Arrays.copyOf()</code>方法完成数据的拷贝，<code>Arrays.copyOf()</code>底层是调用<code>System.arryCopy()</code>，将原数组内容拷贝到新数组，然后将引用指向新的数组</p>
<h4 id="扩容的逻辑"><a href="#扩容的逻辑" class="headerlink" title="扩容的逻辑"></a>扩容的逻辑</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a capacity at least as large as the given minimum capacity.</span></span><br><span class="line"><span class="comment"> * Returns the current capacity increased by the same amount + 2 if</span></span><br><span class="line"><span class="comment"> * that suffices.</span></span><br><span class="line"><span class="comment"> * Will not return a capacity greater than &#123;<span class="doctag">@code</span> MAX_ARRAY_SIZE&#125;</span></span><br><span class="line"><span class="comment"> * unless the given minimum capacity is greater than that.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  minCapacity the desired minimum capacity</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> OutOfMemoryError if minCapacity is less than zero or</span></span><br><span class="line"><span class="comment"> *         greater than Integer.MAX_VALUE</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">newCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// overflow-conscious code</span></span><br><span class="line">    <span class="keyword">int</span> newCapacity = (value.length &lt;&lt; <span class="number">1</span>) + <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        newCapacity = minCapacity;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (newCapacity &lt;= <span class="number">0</span> || MAX_ARRAY_SIZE - newCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        ? hugeCapacity(minCapacity)</span><br><span class="line">        : newCapacity;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">hugeCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Integer.MAX_VALUE - minCapacity &lt; <span class="number">0</span>) &#123; <span class="comment">// overflow</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> OutOfMemoryError();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (minCapacity &gt; MAX_ARRAY_SIZE)</span><br><span class="line">        ? minCapacity : MAX_ARRAY_SIZE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从源码和注释我们能看出，扩容的逻辑实际上是：</p>
<ol>
<li><p>将现有的<strong>容量*2+2</strong></p>
<blockquote>
<p>关于为什么扩容是两倍+2？</p>
<ul>
<li>旧版本的JDK，扩容语句是 <code>(value.length + 1) * 2</code> 先加一再乘2，推测原意思是扩容的话至少增添一个空间再乘2，兼顾到扩容的次数和要减少扩容过大浪费的空间</li>
<li><code>newCapacity(int)</code>的传入参数有可能是0，<code>0&lt;&lt;1</code>结果还是0，如果没有+2，在数组初始化的时候就会报错，所以考虑到设计的安全性，防止出现报错，选择了+2</li>
</ul>
</blockquote>
</li>
<li><p>再判断这个扩容后的容量是否满足要求，如果还是不满足，就直接扩大到需要的容量</p>
</li>
<li><p>然后还需要对扩容后的新数组大小进行检查，若新数组大于<code>Interger.MAX_VALUE</code>，则报<code>OutOfMemoryError()</code>异常</p>
</li>
</ol>
<h3 id="线程安全性"><a href="#线程安全性" class="headerlink" title="线程安全性"></a>线程安全性</h3><p>StringBuffer对所有实现的方法几乎都添加了 synchronized 关键字修饰，实现了同步，保证了数据同步和线程安全</p>
<blockquote>
<p>但是方法同步需要消耗一定的系统资源，所以 StringBuffer 虽然安全，但是效率不如 StringBuilder</p>
</blockquote>
<h2 id="StringBuilder"><a href="#StringBuilder" class="headerlink" title="StringBuilder"></a>StringBuilder</h2><p>StringBuilder是一个可变的字符串类，可变是指StringBuilder对象中的内容可变</p>
<p><img src="/2021/01/20/String-StringBuffer和StringBuilder/String_Overview.png" alt="Overview"></p>
<h3 id="常用方法-1"><a href="#常用方法-1" class="headerlink" title="常用方法"></a>常用方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//无参构造</span></span><br><span class="line">    StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    System.out.println(<span class="string">"StringBuilder:"</span> + stringBuilder);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取长度</span></span><br><span class="line">    System.out.println(<span class="string">"StringBuilder的长度:"</span> + stringBuilder.length());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//有参构造</span></span><br><span class="line">    stringBuilder = <span class="keyword">new</span> StringBuilder(<span class="string">"Hello World"</span>);</span><br><span class="line">    System.out.println(<span class="string">"StringBuilder:"</span> + stringBuilder);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据索引取值</span></span><br><span class="line">    System.out.println(<span class="string">"下标为2的字符是："</span> + stringBuilder.charAt(<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加：append()</span></span><br><span class="line">    stringBuilder = stringBuilder.append(<span class="string">" Java"</span>);</span><br><span class="line">    System.out.println(<span class="string">"append之后的StringBuilder："</span> + stringBuilder);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除指定区间内的字符：delete(int start, int end)</span></span><br><span class="line">    stringBuilder = stringBuilder.delete(<span class="number">6</span>, <span class="number">12</span>);</span><br><span class="line">    System.out.println(<span class="string">"delete之后的StringBuilder："</span> + stringBuilder);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除指定索引位置处的字符：deleteCharAt(int index)</span></span><br><span class="line">    stringBuilder = stringBuilder.deleteCharAt(<span class="number">3</span>);</span><br><span class="line">    System.out.println(<span class="string">"deleteCharAt之后的StringBuilder："</span> + stringBuilder);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将指定区间内的值替换：replace(int start, int end, String str)</span></span><br><span class="line">    stringBuilder = stringBuilder.replace(<span class="number">0</span>, <span class="number">4</span>, <span class="string">"StringBuilder"</span>);</span><br><span class="line">    System.out.println(<span class="string">"replace之后的StringBuilder："</span> + stringBuilder);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//截取字符串（从指定位置到结尾）：substring(int start)</span></span><br><span class="line">    String str = stringBuilder.substring(<span class="number">6</span>);</span><br><span class="line">    System.out.println(<span class="string">"substring之后的String："</span> + str);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//截取字符串（从指定位置到指定位置）：substring(int start, int end)</span></span><br><span class="line">    str = stringBuilder.substring(<span class="number">0</span>, <span class="number">12</span>);</span><br><span class="line">    System.out.println(<span class="string">"substring之后的String："</span> + str);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//向指定位置插入：insert(int offset, String str)</span></span><br><span class="line">    stringBuilder = stringBuilder.insert(<span class="number">0</span>, <span class="string">"Hello "</span>);</span><br><span class="line">    System.out.println(<span class="string">"insert之后的StringBuilder："</span> + stringBuilder);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从头开始查找指定字符的索引位置：indexOf(String str)</span></span><br><span class="line">    System.out.println(<span class="string">"Java的下标是："</span> + stringBuilder.indexOf(<span class="string">"Java"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从指定位置开始查找指定字符的索引位置：indexOf(String str, int fromIndex)</span></span><br><span class="line">    System.out.println(<span class="string">"下标8之后的a的下标是："</span> + stringBuilder.indexOf(<span class="string">"a"</span>, <span class="number">8</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//字符串反转：reverse()</span></span><br><span class="line">    stringBuilder = stringBuilder.reverse();</span><br><span class="line">    System.out.println(<span class="string">"reverse之后的StringBuilder："</span> + stringBuilder);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回StringBuffer对应的String：toString()</span></span><br><span class="line">    str = stringBuilder.toString();</span><br><span class="line">    System.out.println(<span class="string">"StringBuilder对应的String："</span> + str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="源码分析-1"><a href="#源码分析-1" class="headerlink" title="源码分析"></a>源码分析</h3><p>观察<code>StringBuilder</code>源码，发现<code>StringBuiler</code>与<code>StringBuffer</code>继承自同一个父类<code>AbstractStringBuilder</code>，实现的接口也是完全一样的。<code>StringBuiler</code>与<code>StringBuffer</code>最大的区别就是，<code>StringBuffer</code>对几乎所有的方法都添加了<code>synchronized</code>关键字修饰实现了同步，而<code>StringBuiler</code>没有实现同步，所以<code>StringBuiler</code>无法保证线程安全</p>
<h3 id="线程不安全"><a href="#线程不安全" class="headerlink" title="线程不安全"></a>线程不安全</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    <span class="comment">//开启10个线程</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="comment">//每个线程添加1000个字符"a"</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">1000</span>; j++) &#123;</span><br><span class="line">                    stringBuilder.append(<span class="string">"a"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//若是线程安全，则执行完毕后stringBuilder的长度应该为10*1000=10000</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        System.out.println(stringBuilder.length());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分析上述代码运行结果，具体讨论下关于StringBuilder的线程不安全性</p>
<p><img src="/2021/01/20/String-StringBuffer和StringBuilder/StringBuilder_NotSafe.png" alt="StringBuilder线程不安全"></p>
<p>运行结果是，输出的长度是比10000小的，且多运行几次会发现，有可能会出现数组越界异常</p>
<p><strong>首先，分析为什么达不到10000？</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> AbstractStringBuilder <span class="title">append</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (str == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> appendNull();</span><br><span class="line">    <span class="keyword">int</span> len = str.length();</span><br><span class="line">    ensureCapacityInternal(count + len);</span><br><span class="line">    str.getChars(<span class="number">0</span>, len, value, count);</span><br><span class="line">    count += len;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>观察<code>append()</code>的源码，<code>count += len;</code>这条语句在多线程同时访问时很可能会出现计数错误。比如<code>count = 0，len = 1</code>，两个线程同时执行到这一行，获取的 count 都是 0，执行的结果都是 1，所以最终 count 的值为 1，而不是 2。这就解释了为什么最终的结果达不到预期大小的原因。</p>
<p><strong>然后，为什么会出现数组越界异常呢？</strong></p>
<p>字符的添加是通过调用<code>putStringAt(count,str)</code>方法完成的，count 为当前字符串的长度，通过 <code>ensureCapacityinternal(count+len)</code>方法对数组进行扩容之后，它一定是小于等于数组最大容量的，<code>putStringAt(count,str)</code>方法中每添加一个字符，都会给 count 加 1，当到达数组长度上限之后再进行扩容</p>
<p>但是如果是两个线程同时执行<code>putStringAt(count,str)</code>，假设此时的 count = 3，数组容量为 4，两个线程拿到的 count 都为 3，数组容量大于 count，所以并不会进行扩容，这就意味着只剩一个空间，要插入两个字符，线程 A 执行完毕，count 变为 4，已经占满了整个数组，所以线程 B 执行的时候，超出了数组的长度，抛出异常</p>
<p><img src="/2021/01/20/String-StringBuffer和StringBuilder/StringBuilder_Error.jpg" alt="数组越界异常"></p>
<h2 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h2><h3 id="效率对比"><a href="#效率对比" class="headerlink" title="效率对比"></a>效率对比</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//String</span></span><br><span class="line">    <span class="keyword">long</span> startTime1 = System.currentTimeMillis();</span><br><span class="line">    String s1 = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50000</span>; i++) &#123;</span><br><span class="line">        s1 += i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">long</span> endTime1 = System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">"String类型操作耗时"</span> + (endTime1 - startTime1) + <span class="string">"毫秒"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//StringBuffer</span></span><br><span class="line">    <span class="keyword">long</span> startTime2 = System.currentTimeMillis();</span><br><span class="line">    StringBuffer s2 = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50000</span>; i++) &#123;</span><br><span class="line">        s2.append(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">long</span> endTime2 = System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">"StringBuffer类型操作耗时"</span> + (endTime2 - startTime2) + <span class="string">"毫秒"</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"========================================================"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//StringBuffer</span></span><br><span class="line">    <span class="keyword">long</span> startTime3 = System.currentTimeMillis();</span><br><span class="line">    StringBuffer s3 = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5000000</span>; i++) &#123;</span><br><span class="line">        s3.append(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">long</span> endTime3 = System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">"StringBuffer类型操作耗时"</span> + (endTime3 - startTime3) + <span class="string">"毫秒"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//StringBuilder</span></span><br><span class="line">    <span class="keyword">long</span> startTime4 = System.currentTimeMillis();</span><br><span class="line">    StringBuilder s4 = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5000000</span>; i++) &#123;</span><br><span class="line">        s4.append(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">long</span> endTime4 = System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">"StringBuilder类型操作耗时"</span> + (endTime4 - startTime4) + <span class="string">"毫秒"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/01/20/String-StringBuffer和StringBuilder/Compare_String_Buffer_Builder.png" alt="结果对比"></p>
<p>从测试结果来看，对字符串进行大量次数的拼接操作，<code>StringBuffer</code>比<code>String</code>的耗时要小得多。但是同时对比<code>StringBuffer</code>与<code>StringBuilder</code>的操作耗时，由于<code>StringBuffer</code>线程同步需要消耗一定的系统资源，所以效率不如<code>StringBuilder</code>，但是<code>StringBuffer</code>比<code>StringBuilder</code>更安全</p>
<h3 id="StringBuilder-的效率一定就比-String-更高吗？"><a href="#StringBuilder-的效率一定就比-String-更高吗？" class="headerlink" title="StringBuilder 的效率一定就比 String 更高吗？"></a>StringBuilder 的效率一定就比 String 更高吗？</h3><p>会存在这个问题，就说明答案显然是不一定(￣▽￣)”</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String str = <span class="string">"Hello"</span>+<span class="string">"World"</span>;</span><br><span class="line">StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder(<span class="string">"Hello"</span>);</span><br><span class="line">stringBuilder.append(<span class="string">"World"</span>);</span><br></pre></td></tr></table></figure>
<p>上面这种情况下，直接使用String创建对象的效率更高</p>
<p>因为String对象的<strong>直接拼接</strong>，JVM会自动对其进行优化，也就是说”Hello”+”World”在<strong>编译期间</strong>会自动优化为”HelloWorld”，直接一次性创建完成，所以效率肯定要高于StringBuffer的append拼接</p>
<p>但是要注意区分直接拼接和间接拼接</p>
<h3 id="直接拼接与间接拼接"><a href="#直接拼接与间接拼接" class="headerlink" title="直接拼接与间接拼接"></a>直接拼接与间接拼接</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//直接拼接</span></span><br><span class="line">String str1 = <span class="string">"Hello World"</span>;</span><br><span class="line">String str2 = <span class="string">"Hello"</span> + <span class="string">" World"</span>;</span><br><span class="line">System.out.println(str1 == str2);<span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//间接拼接</span></span><br><span class="line">String str11 = <span class="string">"Hello World"</span>;</span><br><span class="line">String str22 = <span class="string">"Hello"</span>;</span><br><span class="line">String str33 = str22 + <span class="string">" World"</span>;</span><br><span class="line">System.out.println(str11 == str33);<span class="comment">//false</span></span><br></pre></td></tr></table></figure>
<p><strong>分析：</strong></p>
<ul>
<li>“Hello”+”World”在编译期间会被JVM自动优化成”Hello World”，是一个字符串常量，由于常量池中已存在”Hello World”，所以指向同一个对象</li>
<li>str2 + “ World” 对变量进行的间接拼接，JVM在编译期间不会自动优化，相当于新建了一个对象</li>
</ul>
<h4 id="【补】代码分析"><a href="#【补】代码分析" class="headerlink" title="【补】代码分析"></a><strong>【补】代码分析</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    String str = <span class="string">"Hello"</span>;</span><br><span class="line">    test(str);</span><br><span class="line">    System.out.println(str);    <span class="comment">//输出：Hello</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    str += <span class="string">"World"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分析：String不可变，Java是值传递，方法内改变的只是副本（新对象）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    StringBuffer str = <span class="keyword">new</span> StringBuffer(<span class="string">"Hello"</span>);</span><br><span class="line">    test(str);</span><br><span class="line">    System.out.println(str);    <span class="comment">//输出：Hello World</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(StringBuffer str)</span> </span>&#123;</span><br><span class="line">    str.append(<span class="string">" World"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分析：StringBuffer可变，且append()源码中是<code>return this;</code>，即是在当前对象后面追加元素并返回当前对象</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li><strong>可变与不可变</strong></li>
</ol>
<ul>
<li><p><code>String</code>不可变</p>
</li>
<li><p><code>StringBuffer</code>和<code>StringBuilder</code>可变</p>
</li>
</ul>
<ol>
<li><p><strong>线程是否安全</strong></p>
<ul>
<li><p><code>String</code>和<code>StringBuffer</code>线程安全</p>
</li>
<li><p><code>StringBuilder</code>线程不安全</p>
</li>
</ul>
</li>
<li><p><strong>是否重写<code>equals()</code>和<code>hashCode()</code>方法</strong></p>
<ul>
<li><code>String</code>重写了<code>equals()</code>和<code>hashCode()</code>方法</li>
<li><code>StringBuffer</code>和<code>StringBuilder</code>没有重写<code>equals()</code>和<code>hashCode()</code>方法</li>
</ul>
</li>
</ol>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><p>当需要对字符串对象进行频繁的修改时，使用<code>StringBuffer</code>可以极大提升程序的效率。在需要考虑线程安全的场景下我们可以使用 <code>StringBuffer</code>，不需要考虑线程安全，追求更高效率的场景下可以使用<code>StringBuilder</code></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="https://mp.weixin.qq.com/s/dltB1Fzwdezs4PDN8Thx6w" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/dltB1Fzwdezs4PDN8Thx6w</a></p>
<p><a href="https://www.cnblogs.com/DMingO/p/13407303.html" target="_blank" rel="noopener">https://www.cnblogs.com/DMingO/p/13407303.html</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"><i class="fa fa-tag"></i> Java</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/01/19/Java的值传递/" rel="next" title="Java的值传递">
                <i class="fa fa-chevron-left"></i> Java的值传递
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/01/24/JavaScript基础语法/" rel="prev" title="JavaScript基础语法">
                JavaScript基础语法 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="PiccoloDevil" />
            
              <p class="site-author-name" itemprop="name">PiccoloDevil</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">38</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#String"><span class="nav-number">1.</span> <span class="nav-text">String</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#String创建对象的两种方式"><span class="nav-number">1.1.</span> <span class="nav-text">String创建对象的两种方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#String是不可变的"><span class="nav-number">1.2.</span> <span class="nav-text">String是不可变的</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#String的不可变是什么意思？"><span class="nav-number">1.2.1.</span> <span class="nav-text">String的不可变是什么意思？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#为什么String是不可变的？"><span class="nav-number">1.2.2.</span> <span class="nav-text">为什么String是不可变的？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#关于String不可变的小问题"><span class="nav-number">1.2.3.</span> <span class="nav-text">关于String不可变的小问题</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#StringBuffer"><span class="nav-number">2.</span> <span class="nav-text">StringBuffer</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#常用方法"><span class="nav-number">2.1.</span> <span class="nav-text">常用方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#源码分析"><span class="nav-number">2.2.</span> <span class="nav-text">源码分析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#扩容的逻辑"><span class="nav-number">2.2.1.</span> <span class="nav-text">扩容的逻辑</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#线程安全性"><span class="nav-number">2.3.</span> <span class="nav-text">线程安全性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#StringBuilder"><span class="nav-number">3.</span> <span class="nav-text">StringBuilder</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#常用方法-1"><span class="nav-number">3.1.</span> <span class="nav-text">常用方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#源码分析-1"><span class="nav-number">3.2.</span> <span class="nav-text">源码分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#线程不安全"><span class="nav-number">3.3.</span> <span class="nav-text">线程不安全</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#对比"><span class="nav-number">4.</span> <span class="nav-text">对比</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#效率对比"><span class="nav-number">4.1.</span> <span class="nav-text">效率对比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#StringBuilder-的效率一定就比-String-更高吗？"><span class="nav-number">4.2.</span> <span class="nav-text">StringBuilder 的效率一定就比 String 更高吗？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#直接拼接与间接拼接"><span class="nav-number">4.3.</span> <span class="nav-text">直接拼接与间接拼接</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#【补】代码分析"><span class="nav-number">4.3.1.</span> <span class="nav-text">【补】代码分析</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">5.</span> <span class="nav-text">总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用场景"><span class="nav-number">5.1.</span> <span class="nav-text">使用场景</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#References"><span class="nav-number">6.</span> <span class="nav-text">References</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">PiccoloDevil</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">70.8k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  
  


  

  

  <script type="text/javascript" src="/js/src/clipboard.min.js"></script>  
  <script type="text/javascript" src="/js/src/clipboard-use.js"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":175,"height":325},"mobile":{"show":true},"log":false});</script></body>
</html>
